const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwxJkynCbAnts5Qhjg4hhDIlpd9lVTHZMm5UrAty5bXa6l6QIBwbBJ1HZWXmDHvHYz6/exec";
window.onload=async()=>{const e=await fetch(`${SCRIPT_URL}?action=listarChecklists`),t=await e.json();atualizarCards(t),montarTabela(t),gerarGraficos(t)};
function atualizarCards(e){const t=e.length,a=e.reduce((e,t)=>e+t.total_nc,0),n=t?Math.round((t-a)/t*100):0,o=e.filter(e=>e.total_nc>0).length;document.getElementById("totalChecklists").innerText=`Total: ${t}`,document.getElementById("percentualOK").innerText=`Conformidade: ${n}%`,document.getElementById("maquinasNC").innerText=`Máquinas com N/C: ${o}`}
function montarTabela(e){const t=document.querySelector("#tabelaChecklists tbody");t.innerHTML="",e.slice(-20).reverse().forEach(e=>{const a=document.createElement("tr");a.innerHTML=`<td>${e.data}</td><td>${e.operador}</td><td>${e.maquina}</td><td>${e.tipo}</td><td>${e.total_nc}</td>`,t.appendChild(a)})}
function gerarGraficos(e){const t=document.getElementById("graficoTipo").getContext("2d"),a=document.getElementById("graficoNC").getContext("2d"),n=[...new Set(e.map(e=>e.tipo))],o=n.map(t=>e.filter(e=>e.tipo===t).length);new Chart(t,{type:"pie",data:{labels:n,datasets:[{data:o,backgroundColor:["#66BB6A","#81C784","#388E3C"]}]},options:{plugins:{title:{display:!0,text:"Tipos de Checklist"}}}});const c={};e.forEach(e=>{c[e.data.split(" ")[0]]=(c[e.data.split(" ")[0]]||0)+e.total_nc}),new Chart(a,{type:"bar",data:{labels:Object.keys(c),datasets:[{label:"Não Conformes",data:Object.values(c),backgroundColor:"#C62828"}]},options:{plugins:{title:{display:!0,text:"N/C por Dia"}}}})}